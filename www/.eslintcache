[{"/home/fabio/Projects/secret-amm-limit-orders/www/src/index.tsx":"1","/home/fabio/Projects/secret-amm-limit-orders/www/src/reportWebVitals.ts":"2","/home/fabio/Projects/secret-amm-limit-orders/www/src/App.tsx":"3","/home/fabio/Projects/secret-amm-limit-orders/www/src/Containers/ViewKeyButton.js":"4","/home/fabio/Projects/secret-amm-limit-orders/www/src/Containers/CreateNewLimitOrder.tsx":"5","/home/fabio/Projects/secret-amm-limit-orders/www/src/Containers/MyActiveLimitOrders.tsx":"6","/home/fabio/Projects/secret-amm-limit-orders/www/src/Containers/MyHistoryLimitOrders.tsx":"7"},{"size":500,"mtime":1611485917504,"results":"8","hashOfConfig":"9"},{"size":425,"mtime":1611485917504,"results":"10","hashOfConfig":"9"},{"size":8227,"mtime":1614687333044,"results":"11","hashOfConfig":"9"},{"size":2249,"mtime":1614535087086,"results":"12","hashOfConfig":"9"},{"size":14707,"mtime":1614536410521,"results":"13","hashOfConfig":"9"},{"size":13391,"mtime":1614675592604,"results":"14","hashOfConfig":"9"},{"size":10667,"mtime":1614675602296,"results":"15","hashOfConfig":"9"},{"filePath":"16","messages":"17","errorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":"18"},"ef2xb6",{"filePath":"19","messages":"20","errorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":"18"},{"filePath":"21","messages":"22","errorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":null},{"filePath":"23","messages":"24","errorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"25","usedDeprecatedRules":"26"},{"filePath":"27","messages":"28","errorCount":0,"warningCount":5,"fixableErrorCount":0,"fixableWarningCount":0,"source":"29","usedDeprecatedRules":"30"},{"filePath":"31","messages":"32","errorCount":0,"warningCount":10,"fixableErrorCount":0,"fixableWarningCount":0,"source":"33","usedDeprecatedRules":"18"},{"filePath":"34","messages":"35","errorCount":0,"warningCount":7,"fixableErrorCount":0,"fixableWarningCount":0,"source":"36","usedDeprecatedRules":"18"},"/home/fabio/Projects/secret-amm-limit-orders/www/src/index.tsx",[],["37","38"],"/home/fabio/Projects/secret-amm-limit-orders/www/src/reportWebVitals.ts",[],"/home/fabio/Projects/secret-amm-limit-orders/www/src/App.tsx",["39"],"/home/fabio/Projects/secret-amm-limit-orders/www/src/Containers/ViewKeyButton.js",["40"],"import React, {useState,useEffect} from 'react';\nimport {Spinner, Button} from \"react-bootstrap\"\n\n// eslint-disable-next-line import/no-anonymous-default-export\nexport default ({\n    ORDERS_FACTORY_ADDRESS,\n    client,\n    viewKey,\n    setViewKey\n}) => {\n    const [loading, setLoading] = useState(false)\n\n    useEffect(() => {\n        if (client.ready && !viewKey.ready) {\n          const viewKeys = localStorage.getItem(\"vk\");\n          if (viewKeys && JSON.parse(viewKeys)[ORDERS_FACTORY_ADDRESS] && JSON.parse(viewKeys)[ORDERS_FACTORY_ADDRESS][client.accountData.address]) {\n            setViewKey({\n              ready: true,\n              value: JSON.parse(viewKeys)[ORDERS_FACTORY_ADDRESS][client.accountData.address]\n            })\n          } else {\n            setViewKey({\n              ready: true,\n              value: null\n            })\n          }\n        }\n      }, [client, setViewKey, viewKey.ready])\n      \n    if (viewKey.ready && !viewKey.value) {\n        return (\n            <Button variant=\"primary\" onClick={async() => {\n                setLoading(true)\n                try {\n                    const response = await getViewKey(client.execute, ORDERS_FACTORY_ADDRESS)\n                    localStorage.setItem(\"vk\",JSON.stringify({[ORDERS_FACTORY_ADDRESS]: {[client.accountData.address]: response}}))\n                    setViewKey({\n                      ready: true,\n                      value: response\n                    })\n                } catch {}\n                setLoading(false)\n              }}>\n                  {\n                    loading ? <Spinner animation=\"border\" /> : \"Create View Key\"\n                  }\n            </Button>\n        )\n    } else {\n        return null\n    }\n}\n\nconst { fromUtf8 } = require(\"@iov/encoding\");\n\n// eslint-disable-next-line import/no-anonymous-default-export\nconst getViewKey = async (client, tokenAddress) => {\n    let handleMsg = { create_viewing_key: {entropy: \"1321313123\"} };\n    const response = await client.execute(tokenAddress, handleMsg);\n    const apiKey = JSON.parse(fromUtf8(response.data))\n    if (apiKey.create_viewing_key) {\n      return apiKey.create_viewing_key.key\n    } else if (apiKey.viewing_key) {\n      return apiKey.viewing_key.key\n    }\n  }",["41","42"],"/home/fabio/Projects/secret-amm-limit-orders/www/src/Containers/CreateNewLimitOrder.tsx",["43","44","45","46","47"],"import React, {useState,useEffect} from 'react';\nimport {Card, Button, Spinner, Modal, DropdownButton, Dropdown, Form, Nav} from 'react-bootstrap'\n\n// eslint-disable-next-line import/no-anonymous-default-export\nexport default ({\n    AMM_FACTORY_ADDRESS,\n    ORDERS_FACTORY_ADDRESS,\n    tokensData,\n    client,\n    viewKey,\n    remountMyLimitOrders\n}: CreateNewLimitOrderProps) => {\n    const [showCreateLimitOrderModal, setShowCreateLimitOrderModal] = useState(false);\n    const [secretOrderBooks, setSecretOrderBooks] = useState<any>(null);\n    const [selectedAmmFactoryPairIndex, setSelectedAmmFactoryPairIndex] = useState<any>(null)\n\n    const [createLimitOrderLoading, setCreateLimitOrderLoading] = useState<boolean>(false);\n    const [selectedAmmPriceLoading, setSelectedAmmPairPriceLoading] = useState<boolean>(false);\n    const [selectedAmmPairPrice, setSelectedAmmPairPrice] = useState<any>(null);\n\n    const [limitOrderIsBidInput, setLimitOrderIsBidInput] = useState<boolean>(true);\n    const [limitOrderAmountInput, setLimitOrderAmountInput] = useState<any>(null);\n    const [limitOrderPriceInput, setLimitOrderPriceInput] = useState<any>(null);\n\n    useEffect(() => {\n        async function init() {\n            const response = await client.execute.queryContractSmart(ORDERS_FACTORY_ADDRESS, { \n                secret_order_books: {}\n              })\n            setSecretOrderBooks(response.secret_order_books);\n            /*setAmmFactoryPairs(await client.execute.queryContractSmart(AMM_FACTORY_ADDRESS, { \n                pairs: {}\n              }));*/\n          }\n        init()\n    }, [])\n\n    useEffect(() => {\n        async function getData() {\n            if (selectedAmmFactoryPairIndex !== null) {\n                try {\n                    const responsePromiseAMM = getAmmPrice();\n                    //const responsePromiseOrderBook = getOrderBook();\n    \n                    const [responseAMM] = await Promise.all([responsePromiseAMM]);\n    \n                    setSelectedAmmPairPrice(responseAMM)\n                    setSelectedAmmPairPriceLoading(false)\n                    /*setOrderBookPair({\n                        isInstanciated: responseOrderBook.secret_order_books.secret_order_book ? true : false,\n                        data: responseOrderBook.secret_order_books.secret_order_book\n                    })*/\n                } catch(e){alert(e)}\n            }\n        }\n        getData()\n    }, [selectedAmmFactoryPairIndex])\n\n    const getAmmPrice = async () => {\n        return client.execute.queryContractSmart(secretOrderBooks.secret_order_books[selectedAmmFactoryPairIndex].amm_pair_contract_addr, { \n            simulation: {\n                offer_asset: {\n                    info: {\n                        token: {\n                            ...secretOrderBooks.secret_order_books[selectedAmmFactoryPairIndex].asset_infos[0].token,\n                            viewing_key: \"\"\n                        }\n                    },\n                    amount: \"\" + Math.pow(10, tokensData.find((data: any) => data.dst_address === secretOrderBooks.secret_order_books[selectedAmmFactoryPairIndex].asset_infos[0].token.contract_addr).decimals)\n                }\n            }\n          })\n    }\n\n    /*const getOrderBook = async () => {\n        return client.execute.queryContractSmart(ORDERS_FACTORY_ADDRESS, { \n            secret_order_books: {\n                contract_address: secretOrderBooks.secretOrderBooks[selectedAmmFactoryPairIndex].contract_addr\n            }\n          })\n    }*/\n\n    const getTokenSymbol = (address: string) => {\n        const tokenData = tokensData.find((data: any) => data.dst_address === address);\n        return (tokenData ? tokenData.display_props.symbol : address)\n    } \n\n    const displaySymbolPair = (pair: any) => {\n        const token1Address = pair.asset_infos[0].token ? pair.asset_infos[0].token.contract_addr : pair.asset_infos[0].native_token.denom;\n        const token1Data = tokensData.find((data: any) => data.dst_address === token1Address);\n        const token2Address = pair.asset_infos[1].token ? pair.asset_infos[1].token.contract_addr : pair.asset_infos[1].native_token.denom;\n        const token2Data = tokensData.find((data: any) => data.dst_address === token2Address);\n        return (token1Data ? token1Data.display_props.symbol : token1Address) + \" / \" + (token2Data ? token2Data.display_props.symbol : token2Address) \n    }\n\n    const getCurrentPrice = () => {\n        if(selectedAmmPairPrice) {\n            const tokenData = tokensData.find((data: any) => data.dst_address === secretOrderBooks.secret_order_books[selectedAmmFactoryPairIndex].asset_infos[1].token.contract_addr)\n            const otherTokenData = tokensData.find((data: any) => data.dst_address === secretOrderBooks.secret_order_books[selectedAmmFactoryPairIndex].asset_infos[0].token.contract_addr)\n            return selectedAmmPairPrice.return_amount / Math.pow(10, tokenData.decimals) + \" \" + tokenData.display_props.symbol + \" per \" + otherTokenData.display_props.symbol\n        }\n                                    \n    }\n\n    console.log(tokensData && secretOrderBooks && secretOrderBooks.secret_order_books)\n\n    return (\n        <div>\n            <Button onClick={() => setShowCreateLimitOrderModal(true)}>Create New Limit Order</Button>\n            <Modal show={showCreateLimitOrderModal} onHide={() => {\n                setShowCreateLimitOrderModal(false)\n                setSelectedAmmFactoryPairIndex(null)\n            }}>\n                <Modal.Header closeButton>\n                <Modal.Title>Create Limit Order</Modal.Title>\n                </Modal.Header>\n                <Modal.Body>\n                    {\n                        tokensData && secretOrderBooks && \n                            <DropdownButton id=\"dropdown-basic-button\" title={\n                                selectedAmmFactoryPairIndex !== null ? \n                                    displaySymbolPair(secretOrderBooks.secret_order_books[selectedAmmFactoryPairIndex])\n                                : \"Select Pair...\"\n                            }>\n                                {\n                                    secretOrderBooks!.secret_order_books.map((pair: any, index: number) =>\n                                        <Dropdown.Item key={pair.contract_addr} onClick={() => {\n                                            setSelectedAmmPairPriceLoading(true)\n                                            setSelectedAmmFactoryPairIndex(index)\n                                        }}>\n                                            {\n                                                displaySymbolPair(pair)\n                                            }\n                                        </Dropdown.Item>\n                                    )\n                                }   \n                            </DropdownButton>\n                    }\n                    {\n                        selectedAmmFactoryPairIndex !== null &&\n                        <div>\n                            <br/>\n                            { selectedAmmPriceLoading && <Spinner animation=\"border\"/> }\n                            { !selectedAmmPriceLoading && selectedAmmPairPrice && getCurrentPrice()}\n                            <br/>\n                            <br/>\n                            <Button style={{marginRight: \"20px\"}} variant={limitOrderIsBidInput ? \"success\" : \"light\"} onClick={() => { setLimitOrderIsBidInput(true)}}> \n                                    Buy \n                            </Button>\n                            <Button variant={!limitOrderIsBidInput ? \"danger\" : \"light\"} onClick={() => { setLimitOrderIsBidInput(false)}}> \n                                    Sell \n                            </Button>\n                            <br/>\n                            <br/>\n                            <label>{`Price of Limit Order (` + getTokenSymbol(secretOrderBooks.secret_order_books[selectedAmmFactoryPairIndex].asset_infos[1].token.contract_addr) + \")\"}</label><br/>\n                            <input onChange={(e) => setLimitOrderPriceInput(e.target.value)}></input><br/>\n                            <label>{\n                                limitOrderIsBidInput ?\n                                `Deposit Amount (` + getTokenSymbol(secretOrderBooks.secret_order_books[selectedAmmFactoryPairIndex].asset_infos[1].token.contract_addr) + \")\" \n                                :\n                                `Deposit Amount (` + getTokenSymbol(secretOrderBooks.secret_order_books[selectedAmmFactoryPairIndex].asset_infos[0].token.contract_addr) + \")\"\n                            }\n                            </label><br/>\n                            <input onChange={(e) => setLimitOrderAmountInput(e.target.value)}></input><br/>\n                            <label>{\n                                limitOrderIsBidInput ?\n                                `Expected Amount (` + getTokenSymbol(secretOrderBooks.secret_order_books[selectedAmmFactoryPairIndex].asset_infos[0].token.contract_addr) + \")\" \n                                :\n                                `Expected Amount (` + getTokenSymbol(secretOrderBooks.secret_order_books[selectedAmmFactoryPairIndex].asset_infos[1].token.contract_addr) + \")\"\n                            }\n                            </label><br/>\n                            <input disabled value={\n                                limitOrderAmountInput && limitOrderPriceInput ? \n                                    (\n                                        limitOrderIsBidInput ? (\"\" + limitOrderAmountInput/limitOrderPriceInput)\n                                        : (\"\" + limitOrderAmountInput*limitOrderPriceInput)\n                                    )\n                                : \"\"\n                            }></input><br/>\n                            <br/>\n                            { \n                                <Button \n                                    style={{width: \"100%\"}}\n                                    variant={limitOrderIsBidInput ? \"success\" : \"danger\"}\n                                    onClick={async() => {\n                                        try {\n                                            if(\n                                                limitOrderAmountInput === null || limitOrderAmountInput === \"\" || limitOrderAmountInput === \"0\" ||\n                                                limitOrderPriceInput === null || limitOrderPriceInput === \"\" || limitOrderPriceInput === \"0\") {\n                                                throw Error(\"Bad Inputs\");\n                                            }   \n\n                                            const limitOrderExpectedAmount: any = \n                                                limitOrderIsBidInput ? (\"\" + limitOrderAmountInput/limitOrderPriceInput)\n                                                    : (\"\" + limitOrderAmountInput*limitOrderPriceInput)\n                                            // loading\n                                            setCreateLimitOrderLoading(true)\n                                            await client.execute.execute(\n                                                secretOrderBooks.secret_order_books[selectedAmmFactoryPairIndex].asset_infos[limitOrderIsBidInput ? 1 : 0].token.contract_addr,\n                                                { \n                                                    send: {\n                                                        recipient: secretOrderBooks.secret_order_books[selectedAmmFactoryPairIndex].contract_addr,\n                                                        amount: \"\" + Math.floor(limitOrderAmountInput*Math.pow(10, tokensData.find((data: any) => data.dst_address === secretOrderBooks.secret_order_books[selectedAmmFactoryPairIndex].asset_infos[limitOrderIsBidInput ? 1 : 0].token.contract_addr).decimals)),\n                                                        msg: btoa(JSON.stringify({\n                                                            create_limit_order: {\n                                                                is_bid: limitOrderIsBidInput,\n                                                                price: \"\" + Math.floor(limitOrderPriceInput*Math.pow(10, tokensData.find((data: any) => data.dst_address === secretOrderBooks.secret_order_books[selectedAmmFactoryPairIndex].asset_infos[1].token.contract_addr).decimals)),\n                                                                expected_amount: \"\" + Math.floor(limitOrderExpectedAmount*Math.pow(10, tokensData.find((data: any) => data.dst_address === secretOrderBooks.secret_order_books[selectedAmmFactoryPairIndex].asset_infos[limitOrderIsBidInput ? 0 : 1].token.contract_addr).decimals)),\n                                                            }\n                                                        }))\n                                                    } \n                                                }\n                                            )\n                                            setCreateLimitOrderLoading(false)\n                                            // sair deste e fazer refresh do outro\n                                            setShowCreateLimitOrderModal(false)\n                                            setSelectedAmmFactoryPairIndex(null)\n                                            remountMyLimitOrders()\n                                        } catch (e) {\n                                            alert(e)\n                                            setCreateLimitOrderLoading(false)\n                                        }\n                                    }\n                                }> \n                                    {\n                                        createLimitOrderLoading ? <Spinner animation=\"border\"/> : limitOrderIsBidInput ? \"Buy\" : \"Sell\"\n                                    }\n                                </Button>\n                            }\n                        </div>\n                    }\n                </Modal.Body>\n                <Modal.Footer>\n                <Button variant=\"secondary\" onClick={() => {\n                    setSelectedAmmFactoryPairIndex(null)\n                    setShowCreateLimitOrderModal(false)\n                }}>\n                    Close\n                </Button>\n                </Modal.Footer>\n            </Modal>\n        </div>\n        )\n}\n\ntype CreateNewLimitOrderProps = {\n    AMM_FACTORY_ADDRESS: string,\n    ORDERS_FACTORY_ADDRESS: string,\n    client: any,\n    tokensData: any,\n    viewKey: string | null,\n    remountMyLimitOrders: any\n}\n\n",["48","49"],"/home/fabio/Projects/secret-amm-limit-orders/www/src/Containers/MyActiveLimitOrders.tsx",["50","51","52","53","54","55","56","57","58","59"],"import React, {useState,useEffect} from 'react';\nimport {Card, Button, Spinner, Modal, DropdownButton, Dropdown, Table} from 'react-bootstrap'\n\nconst PAGINATION_LIMIT = 10;\nconst PAGINATION_OFFSET = 0;\n\n// eslint-disable-next-line import/no-anonymous-default-export\nexport default ({\n    ORDERS_FACTORY_ADDRESS,\n    remountMyLimitOrders,\n    tokensData,\n    client,\n    viewKey\n}: MyLimitOrdersProps) => {\n    const [myLimitOrders, setMyLimitOrders] = useState<any>(null)\n\n    useEffect(() => {\n        async function init() {\n            setMyLimitOrders(await client.execute.queryContractSmart(ORDERS_FACTORY_ADDRESS, { \n                user_secret_order_books: {\n                    address: client.accountData.address,\n                    viewing_key: viewKey\n                }\n              }))\n          }\n        init()\n    }, [])\n\n    return (\n        <div>\n            ACTIVE ORDERS\n            <Table striped bordered hover>\n                <thead>\n                    <tr>\n                        <th>Creation Date</th>\n                        <th>Pair</th>\n                        <th>Type</th>\n                        <th>Status</th>\n                        <th>Limit Order</th>\n                        <th>Triggered Price</th>\n                        <th>Current Price</th>\n                        <th>Withdraw</th>\n                    </tr>\n                </thead>\n                <tbody>\n                {!myLimitOrders && <Spinner animation=\"border\"/>}\n                {\n                    myLimitOrders && myLimitOrders.user_secret_order_books.user_secret_order_book &&\n                        myLimitOrders.user_secret_order_books.user_secret_order_book.map((orderBookAddress: string) => \n                            <MyLimitOrder \n                                orderBookAddress={orderBookAddress}\n                                remountMyLimitOrders={remountMyLimitOrders}\n                                tokensData={tokensData}\n                                client={client}\n                                viewKey={viewKey}\n                                myLimitOrders={myLimitOrders}\n                                setMyLimitOrders={setMyLimitOrders}\n                            />)\n                }\n                </tbody>\n            </Table>\n        </div>\n        \n    )\n}\n\n\nconst MyLimitOrder = ({\n    orderBookAddress,\n    remountMyLimitOrders,\n    tokensData,\n    client,\n    viewKey,\n    myLimitOrders,\n    setMyLimitOrders\n}: any) => {\n    const [activelimitOrderData, setActiveLimitOrderData] = useState<any>(null)\n    const [historyLimitOrdersData, setHistoryLimitOrdersData] = useState<any>(null)\n    const [orderBookTokensData, setOrderBookTokensData] = useState<any>(null)\n    const [ammPriceData, setAmmPriceData] = useState<any>(null)\n\n    useEffect(() => {\n        async function init() {\n            const limitOrderPromise = client.execute.queryContractSmart(orderBookAddress, { \n                get_active_limit_order: {\n                    user_address: client.accountData.address,\n                    user_viewkey: viewKey,\n                    //limit: PAGINATION_LIMIT,\n                    //offset: PAGINATION_OFFSET\n                }\n              })\n\n            const orderBookTokenDataPromise = client.execute.queryContractSmart(orderBookAddress, { \n                order_book_pair_info: {}\n              })\n\n            const [limitOrder, orderBookTokenData] = await Promise.all([limitOrderPromise, orderBookTokenDataPromise]);\n\n            \n            setActiveLimitOrderData(limitOrder.active_limit_order.active_limit_order)\n            setOrderBookTokensData(orderBookTokenData.order_book_pair)\n            setAmmPriceData(await getAmmPrice(orderBookTokenData.order_book_pair))\n\n            setInterval(async () => {\n                const limitOrder = await client.execute.queryContractSmart(orderBookAddress, { \n                    get_active_limit_order: {\n                        user_address: client.accountData.address,\n                        user_viewkey: viewKey,\n                        //limit: PAGINATION_LIMIT,\n                        //offset: PAGINATION_OFFSET\n                    }\n                  })\n                setActiveLimitOrderData(limitOrder.active_limit_order.active_limit_order);\n                setAmmPriceData(await getAmmPrice(orderBookTokenData.order_book_pair))\n            },12000)\n          }\n        init()\n    }, [])\n\n    const getAmmPrice = async (orderBookTokenData: any) => {\n        return client.execute.queryContractSmart(orderBookTokenData.amm_pair_address, { \n            simulation: {\n                offer_asset: {\n                    info: {\n                        token: {\n                            ...orderBookTokenData.assets_info[0].token,\n                            viewing_key: \"\"\n                        }\n                    },\n                    amount: \"\" + Math.pow(10, tokensData.find((data: any) => data.dst_address === orderBookTokenData.assets_info[0].token.contract_addr).decimals)\n                }\n            }\n          })\n    }\n\n    const displayBalance = (index: number, limitOrderData:any, is_withdrew: boolean | null = null) => {\n        const tokenData = tokensData.find((data: any) => data.dst_address === orderBookTokensData.assets_info[index].token.contract_addr);\n        if (!is_withdrew) {\n            return Math.round(limitOrderData.balances[index]/Math.pow(10,orderBookTokensData.assets_info[index].decimal_places) * 100000) / 100000 + \" \" + tokenData.display_props.symbol\n        } else {\n            return Math.round(limitOrderData.withdrew_balance[index]/Math.pow(10,orderBookTokensData.assets_info[index].decimal_places) * 100000) / 100000 + \" \" + tokenData.display_props.symbol\n        }\n    }\n\n    const displayPrice = (type: string, limitOrderData: any) => {\n        const token1Data = tokensData.find((data: any) => data.dst_address === orderBookTokensData.assets_info[0].token.contract_addr);\n        const token2Data = tokensData.find((data: any) => data.dst_address === orderBookTokensData.assets_info[1].token.contract_addr);\n        if (type === \"order\") {\n            return Math.round(limitOrderData.price/Math.pow(10,orderBookTokensData.assets_info[1].decimal_places) * 100000) / 100000 + \" \" + token2Data.display_props.symbol + \" per \" + token1Data.display_props.symbol \n        } else if (type === \"amm\") {\n            return Math.round(ammPriceData.return_amount/Math.pow(10,orderBookTokensData.assets_info[1].decimal_places) * 100000) / 100000 + \" \" + token2Data.display_props.symbol + \" per \" + token1Data.display_props.symbol \n        } else if (type === \"triggered\") {\n            if (limitOrderData.is_bid) {\n                return (Math.round(limitOrderData.deposit_amount/Math.pow(10,orderBookTokensData.assets_info[1].decimal_places) * 100000) / 100000) / (Math.round(limitOrderData.balances[0]/Math.pow(10,orderBookTokensData.assets_info[0].decimal_places) * 100000) / 100000) + \" \" +  token2Data.display_props.symbol + \" per \" + token1Data.display_props.symbol\n            } else {\n                return (Math.round(limitOrderData.balances[1]/Math.pow(10,orderBookTokensData.assets_info[1].decimal_places) * 100000) / 100000) / (Math.round(limitOrderData.deposit_amount/Math.pow(10,orderBookTokensData.assets_info[0].decimal_places) * 100000) / 100000) + \" \" +  token2Data.display_props.symbol + \" per \" + token1Data.display_props.symbol\n            }\n        }\n    }\n\n    const pairDisplay = () => {\n        const token1Data = tokensData.find((data: any) => data.dst_address === orderBookTokensData.assets_info[0].token.contract_addr);\n        const token2Data = tokensData.find((data: any) => data.dst_address === orderBookTokensData.assets_info[1].token.contract_addr);\n\n        return token1Data.display_props.symbol + \" / \" + token2Data.display_props.symbol \n    }\n\n    const findTokenData = (index: number) => \n        tokensData.find((data: any) => data.dst_address === orderBookTokensData.assets_info[index].token.contract_addr);\n\n    const getDepositedAmount = (limitOrderData: any) => {\n        const index = limitOrderData.is_bid ? 1 : 0;\n        const amount = Math.round(limitOrderData.deposit_amount/Math.pow(10,orderBookTokensData.assets_info[index].decimal_places) * 100000) / 100000;\n\n        return \"Deposited: \" + amount + \" \" + findTokenData(index).display_props.symbol\n    }\n\n    const getExpectedAmount = (limitOrderData: any) => {\n        const index = limitOrderData.is_bid ? 0 : 1;\n        const amount = Math.round(limitOrderData.expected_amount/Math.pow(10,orderBookTokensData.assets_info[index].decimal_places) * 100000) / 100000;\n\n        return \"Expected (~): \" + amount + \" \" + findTokenData(index).display_props.symbol\n    }\n\n    const rowStyle = activelimitOrderData ? {\n        backgroundColor: activelimitOrderData.status === \"Filled\" ? \"#Cfffbc\" : \"#Fff4ad\"\n    } : undefined\n    \n    return (\n        <React.Fragment>\n            {\n                // active order\n                activelimitOrderData &&\n                    <tr key={orderBookAddress} style={rowStyle}>\n                        <td>{new Date(activelimitOrderData.timestamp*1000).toLocaleString()}</td>\n                        {orderBookTokensData && tokensData && <td>{pairDisplay()}</td>}\n                        <td>{activelimitOrderData.is_bid ? \"Buy\" : \"Sell\"}</td>\n                        <td>{activelimitOrderData.status}</td>\n                        {orderBookTokensData && \n                            <div>\n                                {displayPrice(\"order\",activelimitOrderData)} <br/><br/>\n                                {getDepositedAmount(activelimitOrderData)}<br/>\n                                {getExpectedAmount(activelimitOrderData)}\n                            </div>}\n                        {<td>{\n                            <div>\n                                {\n                                    ammPriceData && \n                                    activelimitOrderData.status === \"Filled\" ? \n                                    displayPrice(\"triggered\", activelimitOrderData)\n                                    : \" - \"}\n                            </div>\n                        }</td>}\n                        {<td>{ammPriceData ? displayPrice(\"amm\", activelimitOrderData) : \" - \"}</td>}\n                        {activelimitOrderData && <td>{<Button onClick={ async () => {\n                            try{\n                                await client.execute.execute(orderBookAddress, { \n                                    withdraw_limit_order: {}\n                                })\n                                let update = {...myLimitOrders}\n                                let arr = update.user_secret_order_books.user_secret_order_book.filter((address: string) => address !== orderBookAddress)\n                                update.user_secret_order_books.user_secret_order_book = arr\n                                setMyLimitOrders(update)\n                                remountMyLimitOrders()\n                            } catch (e) {\n                                alert(\"error on widthdraw: \" + e)\n                            }\n                        }}>\n                            Widthdraw <br/>\n                            {activelimitOrderData && orderBookTokensData && displayBalance(0, activelimitOrderData) + \"  and  \" + displayBalance(1, activelimitOrderData)}\n                        </Button>}</td>}\n                    </tr>\n            }\n            {\n                /*\n                limitOrdersData && limitOrdersData.history_orders.length > 0 && \n                    limitOrdersData.history_orders.map((history_order:any) => \n                        <tr key={history_order.timestamp}>\n                            <td>{new Date(history_order.timestamp*1000).toLocaleString()}</td>\n                            {orderBookTokensData && tokensData && <td>{pairDisplay()}</td>}\n                            <td>{history_order.is_bid ? \"Buy\" : \"Sell\"}</td>\n                            <td>{history_order.status}</td>\n                            {orderBookTokensData && \n                                <div>\n                                    {displayPrice(\"order\", history_order)} <br/><br/>\n                                    {getDepositedAmount(history_order)}<br/>\n                                    {getExpectedAmount(history_order)}\n                                </div>}\n                            {<td>{\n                                <div>\n                                    {\n                                        ammPriceData && \n                                        history_order.status === \"Filled\" ? \n                                        displayPrice(\"triggered\", history_order)\n                                        : \" - \"}\n                                </div>\n                            }</td>}\n                            {<td> - </td>}\n                            {<td>Withdrew:  {history_order.withdrew_balance && orderBookTokensData && displayBalance(0, history_order, true) + \"  and  \" + displayBalance(1, history_order, true)}</td>}\n                        </tr>\n                    )*/\n            }\n        </React.Fragment>\n    )\n}\n\ntype MyLimitOrdersProps = {\n    ORDERS_FACTORY_ADDRESS: string,\n    remountMyLimitOrders: any,\n    client: any,\n    tokensData: any,\n    viewKey: string | null\n}\n","/home/fabio/Projects/secret-amm-limit-orders/www/src/Containers/MyHistoryLimitOrders.tsx",["60","61","62","63","64","65","66"],"import React, {useState,useEffect} from 'react';\nimport {Card, Button, Spinner, Modal, DropdownButton, Dropdown, Table} from 'react-bootstrap'\n\nconst PAGINATION_LIMIT = 10;\nconst PAGINATION_OFFSET = 0;\n\n// eslint-disable-next-line import/no-anonymous-default-export\nexport default ({\n    ORDERS_FACTORY_ADDRESS,\n    remountMyLimitOrders,\n    tokensData,\n    client,\n    viewKey\n}: MyLimitOrdersProps) => {\n    const [myLimitOrders, setMyLimitOrders] = useState<any>(null)\n\n    useEffect(() => {\n        async function init() {\n            setMyLimitOrders(await client.execute.queryContractSmart(ORDERS_FACTORY_ADDRESS, { \n                user_secret_order_books: {\n                    address: client.accountData.address,\n                    viewing_key: viewKey\n                }\n              }))\n          }\n        init()\n    }, [])\n\n    return (\n        <div>\n            HISTORY ORDERS\n            <Table striped bordered hover>\n                <thead>\n                    <tr>\n                        <th>Creation Date</th>\n                        <th>Pair</th>\n                        <th>Type</th>\n                        <th>Status</th>\n                        <th>Limit Order</th>\n                        <th>Triggered Price</th>\n                        <th>Withdraw</th>\n                    </tr>\n                </thead>\n                <tbody>\n                {!myLimitOrders && <Spinner animation=\"border\"/>}\n                {\n                    myLimitOrders && myLimitOrders.user_secret_order_books.user_secret_order_book &&\n                        myLimitOrders.user_secret_order_books.user_secret_order_book.map((orderBookAddress: string) => \n                            <MyLimitOrder \n                                orderBookAddress={orderBookAddress}\n                                remountMyLimitOrders={remountMyLimitOrders}\n                                tokensData={tokensData}\n                                client={client}\n                                viewKey={viewKey}\n                                myLimitOrders={myLimitOrders}\n                                setMyLimitOrders={setMyLimitOrders}\n                            />)\n                }\n                </tbody>\n            </Table>\n        </div>\n        \n    )\n}\n\n\nconst MyLimitOrder = ({\n    orderBookAddress,\n    remountMyLimitOrders,\n    tokensData,\n    client,\n    viewKey,\n    myLimitOrders,\n    setMyLimitOrders\n}: any) => {\n    const [historyLimitOrdersData, setHistoryLimitOrdersData] = useState<any>(null)\n    const [orderBookTokensData, setOrderBookTokensData] = useState<any>(null)\n    const [ammPriceData, setAmmPriceData] = useState<any>(null)\n\n    useEffect(() => {\n        async function init() {\n            const limitOrderPromise = client.execute.queryContractSmart(orderBookAddress, { \n                get_history_limit_orders: {\n                    user_address: client.accountData.address,\n                    user_viewkey: viewKey,\n                    page_size: PAGINATION_LIMIT,\n                    page: PAGINATION_OFFSET\n                }\n              })\n\n            const orderBookTokenDataPromise = client.execute.queryContractSmart(orderBookAddress, { \n                order_book_pair_info: {}\n              })\n\n            const [limitOrder, orderBookTokenData] = await Promise.all([limitOrderPromise, orderBookTokenDataPromise]);\n\n            console.log(limitOrder)\n            setHistoryLimitOrdersData(limitOrder.history_limit_orders.history_limit_orders)\n            setOrderBookTokensData(orderBookTokenData.order_book_pair)\n            setAmmPriceData(await getAmmPrice(orderBookTokenData.order_book_pair))\n\n            setInterval(async () => {\n                const limitOrder = await client.execute.queryContractSmart(orderBookAddress, { \n                    get_history_limit_orders: {\n                        user_address: client.accountData.address,\n                        user_viewkey: viewKey,\n                        page_size: PAGINATION_LIMIT,\n                        page: PAGINATION_OFFSET\n                    }\n                  })\n                setHistoryLimitOrdersData(limitOrder.history_limit_orders.history_limit_orders);\n                setAmmPriceData(await getAmmPrice(orderBookTokenData.order_book_pair))\n            },12000)\n          }\n        init()\n    }, [])\n\n    const getAmmPrice = async (orderBookTokenData: any) => {\n        return client.execute.queryContractSmart(orderBookTokenData.amm_pair_address, { \n            simulation: {\n                offer_asset: {\n                    info: {\n                        token: {\n                            ...orderBookTokenData.assets_info[0].token,\n                            viewing_key: \"\"\n                        }\n                    },\n                    amount: \"\" + Math.pow(10, tokensData.find((data: any) => data.dst_address === orderBookTokenData.assets_info[0].token.contract_addr).decimals)\n                }\n            }\n          })\n    }\n\n    const displayBalance = (index: number, limitOrderData:any, is_withdrew: boolean | null = null) => {\n        const tokenData = tokensData.find((data: any) => data.dst_address === orderBookTokensData.assets_info[index].token.contract_addr);\n        if (!is_withdrew) {\n            return Math.round(limitOrderData.balances[index]/Math.pow(10,orderBookTokensData.assets_info[index].decimal_places) * 100000) / 100000 + \" \" + tokenData.display_props.symbol\n        } else {\n            return Math.round(limitOrderData.withdrew_balance[index]/Math.pow(10,orderBookTokensData.assets_info[index].decimal_places) * 100000) / 100000 + \" \" + tokenData.display_props.symbol\n        }\n    }\n\n    const displayPrice = (type: string, limitOrderData: any) => {\n        const token1Data = tokensData.find((data: any) => data.dst_address === orderBookTokensData.assets_info[0].token.contract_addr);\n        const token2Data = tokensData.find((data: any) => data.dst_address === orderBookTokensData.assets_info[1].token.contract_addr);\n        if (type === \"order\") {\n            return Math.round(limitOrderData.price/Math.pow(10,orderBookTokensData.assets_info[1].decimal_places) * 100000) / 100000 + \" \" + token2Data.display_props.symbol + \" per \" + token1Data.display_props.symbol \n        } else if (type === \"amm\") {\n            return Math.round(ammPriceData.return_amount/Math.pow(10,orderBookTokensData.assets_info[1].decimal_places) * 100000) / 100000 + \" \" + token2Data.display_props.symbol + \" per \" + token1Data.display_props.symbol \n        } else if (type === \"triggered\") {\n            if (limitOrderData.withdrew_balance) {\n                if (limitOrderData.is_bid) {\n                    return (Math.round(limitOrderData.deposit_amount/Math.pow(10,orderBookTokensData.assets_info[1].decimal_places) * 100000) / 100000) / (Math.round(limitOrderData.withdrew_balance[0]/Math.pow(10,orderBookTokensData.assets_info[0].decimal_places) * 100000) / 100000) + \" \" +  token2Data.display_props.symbol + \" per \" + token1Data.display_props.symbol\n                } else {\n                    return (Math.round(limitOrderData.withdrew_balance[1]/Math.pow(10,orderBookTokensData.assets_info[1].decimal_places) * 100000) / 100000) / (Math.round(limitOrderData.deposit_amount/Math.pow(10,orderBookTokensData.assets_info[0].decimal_places) * 100000) / 100000) + \" \" +  token2Data.display_props.symbol + \" per \" + token1Data.display_props.symbol\n                }\n            } else {\n                return \"-\"\n            }\n        }\n    }\n\n    const pairDisplay = () => {\n        const token1Data = tokensData.find((data: any) => data.dst_address === orderBookTokensData.assets_info[0].token.contract_addr);\n        const token2Data = tokensData.find((data: any) => data.dst_address === orderBookTokensData.assets_info[1].token.contract_addr);\n\n        return token1Data.display_props.symbol + \" / \" + token2Data.display_props.symbol \n    }\n\n    const findTokenData = (index: number) => \n        tokensData.find((data: any) => data.dst_address === orderBookTokensData.assets_info[index].token.contract_addr);\n\n    const getDepositedAmount = (limitOrderData: any) => {\n        const index = limitOrderData.is_bid ? 1 : 0;\n        const amount = Math.round(limitOrderData.deposit_amount/Math.pow(10,orderBookTokensData.assets_info[index].decimal_places) * 100000) / 100000;\n\n        return \"Deposited: \" + amount + \" \" + findTokenData(index).display_props.symbol\n    }\n\n    const getExpectedAmount = (limitOrderData: any) => {\n        const index = limitOrderData.is_bid ? 0 : 1;\n        const amount = Math.round(limitOrderData.expected_amount/Math.pow(10,orderBookTokensData.assets_info[index].decimal_places) * 100000) / 100000;\n\n        return \"Expected (~): \" + amount + \" \" + findTokenData(index).display_props.symbol\n    }\n\n    return (\n        <React.Fragment>\n            {\n                historyLimitOrdersData && historyLimitOrdersData.length > 0 && \n                    historyLimitOrdersData.map((history_order:any) => \n                        <tr key={history_order.timestamp}>\n                            <td>{new Date(history_order.timestamp*1000).toLocaleString()}</td>\n                            {orderBookTokensData && tokensData && <td>{pairDisplay()}</td>}\n                            <td>{history_order.is_bid ? \"Buy\" : \"Sell\"}</td>\n                            <td>{history_order.status}</td>\n                            {orderBookTokensData && \n                                <div>\n                                    {displayPrice(\"order\", history_order)} <br/><br/>\n                                    {getDepositedAmount(history_order)}<br/>\n                                    {getExpectedAmount(history_order)}\n                                </div>}\n                            {<td>{\n                                <div>\n                                    {\n                                        ammPriceData && \n                                        history_order.status === \"Withdrew\" ? \n                                        displayPrice(\"triggered\", history_order)\n                                        : \" - \"}\n                                </div>\n                            }</td>}\n                            {<td>Withdrew:  {history_order.withdrew_balance && orderBookTokensData && displayBalance(0, history_order, true) + \"  and  \" + displayBalance(1, history_order, true)}</td>}\n                        </tr>\n                    )\n            }\n        </React.Fragment>\n    )\n}\n\ntype MyLimitOrdersProps = {\n    ORDERS_FACTORY_ADDRESS: string,\n    remountMyLimitOrders: any,\n    client: any,\n    tokensData: any,\n    viewKey: string | null\n}\n",{"ruleId":"67","replacedBy":"68"},{"ruleId":"69","replacedBy":"70"},{"ruleId":"71","severity":1,"message":"72","line":2,"column":8,"nodeType":"73","messageId":"74","endLine":2,"endColumn":12},{"ruleId":"75","severity":1,"message":"76","line":28,"column":10,"nodeType":"77","endLine":28,"endColumn":45,"suggestions":"78"},{"ruleId":"67","replacedBy":"68"},{"ruleId":"69","replacedBy":"70"},{"ruleId":"71","severity":1,"message":"79","line":2,"column":9,"nodeType":"73","messageId":"74","endLine":2,"endColumn":13},{"ruleId":"71","severity":1,"message":"80","line":2,"column":65,"nodeType":"73","messageId":"74","endLine":2,"endColumn":69},{"ruleId":"71","severity":1,"message":"81","line":2,"column":71,"nodeType":"73","messageId":"74","endLine":2,"endColumn":74},{"ruleId":"75","severity":1,"message":"82","line":36,"column":8,"nodeType":"77","endLine":36,"endColumn":10,"suggestions":"83"},{"ruleId":"75","severity":1,"message":"84","line":57,"column":8,"nodeType":"77","endLine":57,"endColumn":37,"suggestions":"85"},{"ruleId":"67","replacedBy":"86"},{"ruleId":"69","replacedBy":"87"},{"ruleId":"71","severity":1,"message":"79","line":2,"column":9,"nodeType":"73","messageId":"74","endLine":2,"endColumn":13},{"ruleId":"71","severity":1,"message":"88","line":2,"column":32,"nodeType":"73","messageId":"74","endLine":2,"endColumn":37},{"ruleId":"71","severity":1,"message":"89","line":2,"column":39,"nodeType":"73","messageId":"74","endLine":2,"endColumn":53},{"ruleId":"71","severity":1,"message":"90","line":2,"column":55,"nodeType":"73","messageId":"74","endLine":2,"endColumn":63},{"ruleId":"71","severity":1,"message":"91","line":4,"column":7,"nodeType":"73","messageId":"74","endLine":4,"endColumn":23},{"ruleId":"71","severity":1,"message":"92","line":5,"column":7,"nodeType":"73","messageId":"74","endLine":5,"endColumn":24},{"ruleId":"75","severity":1,"message":"93","line":27,"column":8,"nodeType":"77","endLine":27,"endColumn":10,"suggestions":"94"},{"ruleId":"71","severity":1,"message":"95","line":78,"column":12,"nodeType":"73","messageId":"74","endLine":78,"endColumn":34},{"ruleId":"71","severity":1,"message":"96","line":78,"column":36,"nodeType":"73","messageId":"74","endLine":78,"endColumn":61},{"ruleId":"75","severity":1,"message":"97","line":118,"column":8,"nodeType":"77","endLine":118,"endColumn":10,"suggestions":"98"},{"ruleId":"71","severity":1,"message":"79","line":2,"column":9,"nodeType":"73","messageId":"74","endLine":2,"endColumn":13},{"ruleId":"71","severity":1,"message":"99","line":2,"column":15,"nodeType":"73","messageId":"74","endLine":2,"endColumn":21},{"ruleId":"71","severity":1,"message":"88","line":2,"column":32,"nodeType":"73","messageId":"74","endLine":2,"endColumn":37},{"ruleId":"71","severity":1,"message":"89","line":2,"column":39,"nodeType":"73","messageId":"74","endLine":2,"endColumn":53},{"ruleId":"71","severity":1,"message":"90","line":2,"column":55,"nodeType":"73","messageId":"74","endLine":2,"endColumn":63},{"ruleId":"75","severity":1,"message":"93","line":27,"column":8,"nodeType":"77","endLine":27,"endColumn":10,"suggestions":"100"},{"ruleId":"75","severity":1,"message":"97","line":116,"column":8,"nodeType":"77","endLine":116,"endColumn":10,"suggestions":"101"},"no-native-reassign",["102"],"no-negated-in-lhs",["103"],"@typescript-eslint/no-unused-vars","'logo' is defined but never used.","Identifier","unusedVar","react-hooks/exhaustive-deps","React Hook useEffect has a missing dependency: 'ORDERS_FACTORY_ADDRESS'. Either include it or remove the dependency array.","ArrayExpression",["104"],"'Card' is defined but never used.","'Form' is defined but never used.","'Nav' is defined but never used.","React Hook useEffect has missing dependencies: 'ORDERS_FACTORY_ADDRESS' and 'client.execute'. Either include them or remove the dependency array.",["105"],"React Hook useEffect has a missing dependency: 'getAmmPrice'. Either include it or remove the dependency array.",["106"],["102"],["103"],"'Modal' is defined but never used.","'DropdownButton' is defined but never used.","'Dropdown' is defined but never used.","'PAGINATION_LIMIT' is assigned a value but never used.","'PAGINATION_OFFSET' is assigned a value but never used.","React Hook useEffect has missing dependencies: 'ORDERS_FACTORY_ADDRESS', 'client.accountData.address', 'client.execute', and 'viewKey'. Either include them or remove the dependency array. If 'setMyLimitOrders' needs the current value of 'client.execute', you can also switch to useReducer instead of useState and read 'client.execute' in the reducer.",["107"],"'historyLimitOrdersData' is assigned a value but never used.","'setHistoryLimitOrdersData' is assigned a value but never used.","React Hook useEffect has missing dependencies: 'client.accountData.address', 'client.execute', 'getAmmPrice', 'orderBookAddress', and 'viewKey'. Either include them or remove the dependency array.",["108"],"'Button' is defined but never used.",["109"],["110"],"no-global-assign","no-unsafe-negation",{"desc":"111","fix":"112"},{"desc":"113","fix":"114"},{"desc":"115","fix":"116"},{"desc":"117","fix":"118"},{"desc":"119","fix":"120"},{"desc":"117","fix":"121"},{"desc":"119","fix":"122"},"Update the dependencies array to be: [ORDERS_FACTORY_ADDRESS, client, setViewKey, viewKey.ready]",{"range":"123","text":"124"},"Update the dependencies array to be: [ORDERS_FACTORY_ADDRESS, client.execute]",{"range":"125","text":"126"},"Update the dependencies array to be: [getAmmPrice, selectedAmmFactoryPairIndex]",{"range":"127","text":"128"},"Update the dependencies array to be: [ORDERS_FACTORY_ADDRESS, client.accountData.address, client.execute, viewKey]",{"range":"129","text":"130"},"Update the dependencies array to be: [client.accountData.address, client.execute, getAmmPrice, orderBookAddress, viewKey]",{"range":"131","text":"132"},{"range":"133","text":"130"},{"range":"134","text":"132"},[883,918],"[ORDERS_FACTORY_ADDRESS, client, setViewKey, viewKey.ready]",[1603,1605],"[ORDERS_FACTORY_ADDRESS, client.execute]",[2432,2461],"[getAmmPrice, selectedAmmFactoryPairIndex]",[834,836],"[ORDERS_FACTORY_ADDRESS, client.accountData.address, client.execute, viewKey]",[4416,4418],"[client.accountData.address, client.execute, getAmmPrice, orderBookAddress, viewKey]",[834,836],[4325,4327]]